<!DOCTYPE html>
<html lang="es">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le Bardol Est√©tica Center</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Estilos generales y reseteo */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f9f0ff 0%, #fff0f5 100%); /* Fondo degradado suave */
            color: #4a2c5e; /* Color de texto principal */
            min-height: 100vh; /* Altura m√≠nima para ocupar toda la pantalla */
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px; /* Espaciado alrededor del cuerpo */
            overflow-x: hidden; /* Evita el scroll horizontal */
        }
        
        /* Contenedor principal de la tarjeta */
        .container {
            max-width: 500px; /* Ancho m√°ximo */
            width: 100%; /* Ocupa el 100% del ancho disponible hasta el max-width */
            background: white; /* Fondo blanco */
            border-radius: 20px; /* Bordes redondeados */
            box-shadow: 0 10px 30px rgba(138, 43, 226, 0.15); /* Sombra suave */
            overflow: hidden; /* Oculta contenido que se desborda */
            margin: 20px 0; /* Margen superior e inferior */
            position: relative;
        }
        
        /* Secci√≥n del encabezado */
        .header {
            background: linear-gradient(135deg, #FFC0CB 0%, #FFB6C1 100%); /* Fondo rosa pastel con degradado */
            color: white; /* Texto blanco */
            padding: 30px 20px; /* Espaciado interno */
            text-align: center; /* Centra el contenido */
            position: relative;
        }
        
        /* Estilos para el logo */
        .header-logo { 
            display: block; 
            margin: 0 auto 15px; 
            max-width: 393px; /* Establece el max-width para el tama√±o original deseado */
            width: 100%; /* Asegura que la imagen sea responsiva */
            height: auto; /* Mantiene la proporci√≥n de la imagen */
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 5px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        .subtitle {
            font-size: 18px;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        /* Tarjeta de oferta */
        .offer-card {
            background: #fff9c4; /* Fondo amarillo claro */
            color: #5d4037; /* Color de texto oscuro */
            border-radius: 15px; /* Bordes redondeados */
            padding: 15px; /* Espaciado interno */
            margin: 20px; /* Margen externo */
            text-align: center; /* Centra el contenido */
            border: 2px dashed #ffd54f; /* Borde punteado */
            position: relative;
        }
        
        .offer-card h2 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #e91e63; /* Color de t√≠tulo de oferta */
        }
        
        .offer-card p {
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        /* Contador regresivo */
        .countdown {
            display: flex;
            justify-content: center;
            gap: 10px; /* Espacio entre los elementos del contador */
            margin: 15px 0;
        }
        
        .countdown-box {
            background: #4a2c5e; /* Fondo oscuro */
            color: white; /* Texto blanco */
            width: 60px;
            height: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .countdown-value {
            font-size: 22px;
        }
        
        .countdown-label {
            font-size: 12px;
            text-transform: uppercase;
            opacity: 0.8;
        }
        
        /* Contenedor del formulario */
        .form-container {
            padding: 20px;
        }
        
        .form-group {
            margin-bottom: 20px; /* Espacio entre grupos de formulario */
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a2c5e;
        }
        
        /* Estilos para input de texto */
        input[type="text"] {
            width: 100%; /* Ocupa todo el ancho disponible */
            padding: 14px; /* Espaciado interno */
            border: 2px solid #e0c8f0;
            border-radius: 12px;
            font-size: 16px;
            background: #f9f0ff;
            transition: all 0.3s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #8a2be2;
            box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.2);
        }

        /* Estilo para mostrar la fecha de turno (que ahora se rellenar√° por JS) */
        #displayDate {
            background: #e0f2f7;
            padding: 14px;
            border: 2px solid #a7d9f7;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            color: #007bb6;
            display: block;
            text-align: center;
        }
        
        /* Estilos de botones */
        .btn {
            display: block;
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
            margin: 10px 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .btn-confirm {
            background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
            color: white;
        }
        
        .btn-invite {
            background: linear-gradient(135deg, #e91e63 0%, #c2185b 100%);
            color: white;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        
        .btn:active:not(:disabled) {
            transform: translateY(1px);
        }
        
        /* Notificaci√≥n emergente */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(110%);
            transition: transform 0.4s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        /* Icono flotante de WhatsApp */
        .whatsapp-icon {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: #25d366;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        /* Pie de p√°gina */
        .footer {
            text-align: center;
            padding: 20px;
            color: #7b68ee;
            font-size: 14px;
            margin-top: 20px;
        }
        
        /* Disclaimer o aviso */
        .disclaimer {
            background: #e0f7fa;
            border-left: 44px solid #00bcd4;
            padding: 10px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
            font-size: 14px;
        }

        /* Nueva tarjeta de referido para difusi√≥n */
        .referral-promo-diffusion {
            background: #e0f7fa;
            color: #00796b;
            border-radius: 15px;
            padding: 15px;
            margin: 20px;
            text-align: center;
            border: 2px dashed #00bcd4;
        }

        .referral-promo-diffusion h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #00bcd4;
        }

        .referral-promo-diffusion p {
            font-size: 15px;
            margin-bottom: 15px;
        }

        /* Estilos para la Ruleta */
        .roulette-section {
            padding: 20px;
            background: #fdfdfd;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
            text-align: center;
            display: none; /* Oculto por defecto, se muestra con JS */
        }

        .roulette-section h1 {
            color: #e91e63;
            font-size: 26px;
            margin-bottom: 20px;
        }

        .roulette-section .referral-offer-text {
            font-size: 16px;
            color: #4a2c5e;
            margin-bottom: 15px;
            padding: 0 10px;
        }

        .roulette-section .spin-count-display {
            font-size: 18px;
            font-weight: bold;
            color: #8a2be2;
            margin-bottom: 15px;
        }

        canvas {
            background-color: #eee;
            display: block;
            margin: 20px auto;
            border: 5px solid #FFC0CB;
            border-radius: 50%;
            box-shadow: 0 0 15px rgba(138, 43, 226, 0.3);
            max-width: 100%; /* Responsivo */
            height: auto; /* Mantiene la proporci√≥n */
        }

        .wheel-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            /* Ajusta la posici√≥n de la flecha para que apunte al centro superior del c√≠rculo */
            transform: translate(-50%, -100%) translateY(-10px); 
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-bottom: 30px solid #e91e63; /* Color de la flecha */
            z-index: 10;
        }

        .buttons-container {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .btn-spin {
            background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%); /* Verde */
            color: white;
        }

        .btn-use-discount {
            background: linear-gradient(135deg, #8a2be2 0%, #6a1b9a 100%); /* Morado */
            color: white;
            display: none; /* Oculto por defecto */
        }

        #resultMessage {
            margin-top: 20px;
            font-size: 22px;
            font-weight: bold;
            color: #e91e63;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #8a2be2;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
            display: none; /* Oculto por defecto */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .prize-timer {
            font-size: 18px;
            font-weight: bold;
            color: #007bb6;
            margin-top: 10px;
            display: none; /* Oculto por defecto */
        }

        .mercadopago-link-container {
            margin-top: 15px;
            font-size: 15px;
            color: #4a2c5e;
        }

        .mercadopago-link-container a {
            color: #007bb6;
            font-weight: bold;
            text-decoration: underline;
        }

    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div>
          <address>
            <img src="logo lb.png" alt="le bardol " title="le bardol logo " class="header-logo">
          </address>
          <br>
        </div>
        <h1 id="mainTitle">Le Bardol Est√©tica Center</h1>
        <p class="subtitle">Tu belleza, nuestra pasi√≥n</p>
      </div>
      <div class="offer-card" id="mainOfferCard">
        <h2 id="offerTitle">¬°Oferta Especial de Referidos!</h2>
        <p id="offerDescription">Confirma tu turno y si invitas a tus amigos en las pr√≥ximas 24
          horas, t√∫ obtienes un <strong>10% DE DESCUENTO</strong> por cada
          uno que contrate un servicio, ¬°y ellos un <strong>50% DE
            DESCUENTO</strong> en su primer tratamiento!</p>
        <div class="countdown">
          <div class="countdown-box">
            <span id="hours" class="countdown-value">24</span>
            <span class="countdown-label">Horas</span>
          </div>
          <div class="countdown-box">
            <span id="minutes" class="countdown-value">00</span>
            <span class="countdown-label">Minutos</span>
          </div>
          <div class="countdown-box">
            <span id="seconds" class="countdown-value">00</span>
            <span class="countdown-label">Segundos</span>
          </div>
        </div>
      </div>

      <!-- SECCI√ìN DE RULETA -->
      <div class="roulette-section" id="rouletteSection">
        <h1>¬°Gira la Ruleta y Gana un Descuento!</h1>
        <p class="referral-offer-text">
            Por cada amigo que invites, ganas un <strong>10% OFF</strong> en tu pr√≥ximo tratamiento si tu amigo saca un turno. ¬°√âl tiene <strong>50% OFF</strong> en su primer servicio!
        </p>
        <p class="spin-count-display" id="spinCountDisplay">Te quedan 3 tiros.</p>
        <div style="position: relative; width: fit-content; margin: 0 auto;">
            <canvas id="rouletteCanvas" width="500" height="500"></canvas> <!-- Aumentado el tama√±o del canvas -->
            <div class="wheel-indicator"></div>
        </div>
        <div class="buttons-container">
            <button class="btn btn-spin" id="spinBtn">
                <i class="fas fa-play-circle"></i> Girar Ruleta
            </button>
            <div class="loading-spinner" id="loadingSpinner"></div>
            <p id="resultMessage"></p>
            <p class="prize-timer" id="prizeTimerDisplay"></p>
            <div class="mercadopago-link-container" id="mercadopagoLinkContainer" style="display: none;">
                <p>Para reservar tu premio, abona una se√±a de <span id="mercadopagoPriceDisplay"></span> aqu√≠:</p>
                <a href="#" id="mercadopagoLink" target="_blank">
                    <i class="fas fa-money-bill-wave"></i> Pagar Se√±a con Mercado Pago
                </a>
            </div>
            <button class="btn btn-use-discount" id="useDiscountBtn">
                <i class="fas fa-gift"></i> Usar este Descuento
            </button>
        </div>
      </div>
      <!-- FIN SECCI√ìN DE RULETA -->

      <div class="referral-promo-diffusion" id="referralPromoDiffusion" style="display: none;">
        <h3>¬°Invita a un amigo y GANA!</h3>
        <p>Si reservas un turno y nos recomiendas a un amigo, obtendr√°s un **5% DE DESCUENTO ADICIONAL** en tu pr√≥xima sesi√≥n cuando tu amigo contrate su primer servicio.</p>
        <button class="btn btn-invite" id="inviteBtnDiffusion">
            <i class="fas fa-user-plus"></i> Invitar a un amigo
        </button>
      </div>
      
      <div class="form-container">
        <div class="disclaimer" id="disclaimerMessage">
          <i class="fas fa-info-circle"></i> Aqu√≠ puedes confirmar tu turno asignado.
          ¬°No olvides la incre√≠ble promoci√≥n de referidos!
        </div>
        <div class="form-group">
          <label for="name">Nombre completo</label>
          <input id="name" placeholder="Ingresa tu nombre completo" type="text"> 
        </div>
        <div class="form-group" id="appointmentDisplayGroup">
          <label>Tu turno est√° asignado para:</label>
          <div id="displayDate"></div> 
        </div>
        <button class="btn btn-confirm" id="confirmBtn">
          <i class="fas fa-calendar-check"></i> CONFIRMAR MI TURNO
        </button>
        <button class="btn btn-invite" id="inviteBtn">
          <i class="fas fa-user-plus"></i> INVITAR A UN AMIGO (50% OFF)
        </button>
      </div>
    </div>
    <div class="notification" id="notification">
      <i class="fas fa-check-circle"></i>
      <span>¬°Turno confirmado con √©xito! Te hemos enviado un mensaje por
        WhatsApp.</span>
    </div>
    <a href="https://wa.me/5493415216025?text=Hola%20Le%20Bardol%2C%20quisiera%20consultar%20sobre%20un%20turno." class="whatsapp-icon" target="_blank">
      <i class="fab fa-whatsapp"></i>
    </a>
    <div class="footer">
      <p>¬© 2023 Le Bardol Est√©tica Center. Todos los derechos reservados.</p>
    </div>
    <script>
        // --- Configuraci√≥n de Mercado Pago (¬°MODIFICA ESTOS VALORES!) ---
        const mercadopagoLinkUrl = 'https://mpago.la/2tpSkE9'; // Tu enlace real de Mercado Pago
        const mercadopagoPrice = '$8000'; // El monto de la se√±a
        // -----------------------------------------------------------------

        // Script para el contador regresivo de 24 horas
        function startCountdown() {
            const savedTime = localStorage.getItem('countdownEndTime');
            let endTime;
            
            // La fecha actual de Argentina (Buenos Aires)
            const nowArgentina = new Date(new Date().toLocaleString("en-US", {timeZone: "America/Argentina/Buenos_Aires"}));

            if (savedTime) {
                endTime = parseInt(savedTime);
                // Si el tiempo guardado ya pas√≥, rein√≠cialo a 24 horas desde ahora
                if (endTime < nowArgentina.getTime()) {
                    endTime = nowArgentina.getTime() + 24 * 60 * 60 * 1000;
                    localStorage.setItem('countdownEndTime', endTime.toString());
                }
            } else {
                endTime = nowArgentina.getTime() + 24 * 60 * 60 * 1000;
                localStorage.setItem('countdownEndTime', endTime.toString());
            }
            
            const timer = setInterval(() => {
                const now = new Date(new Date().toLocaleString("en-US", {timeZone: "America/Argentina/Buenos_Aires"})); 
                const timeLeft = endTime - now.getTime();
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    document.getElementById('hours').textContent = '00';
                    document.getElementById('minutes').textContent = '00';
                    document.getElementById('seconds').textContent = '00';
                    const isReminderLink = getUrlParameter('fecha') !== '';
                    if (isReminderLink) { 
                         document.getElementById('inviteBtn').disabled = true;
                    }
                    return;
                }
                
                const hours = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
                
                document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
            }, 1000);
        }
        
        // Funci√≥n para mostrar la notificaci√≥n de confirmaci√≥n
        function showNotification() {
            const notification = document.getElementById('notification');
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }
        
        // Funci√≥n para validar el formulario antes de enviar (depende del tipo de enlace)
        function validateForm(isReminder) {
            const name = document.getElementById('name').value;
            const displayedDate = document.getElementById('displayDate').textContent;
            
            if (isReminder) { 
                if (!name || name.trim() === '' || name.trim() === "Estimado/a cliente/a" || displayedDate === '' || displayedDate === 'Fecha y hora no v√°lidas' || displayedDate === 'Fecha y hora no asignadas') { 
                    alert('Faltan datos para confirmar tu turno. Por favor, aseg√∫rate de que tu nombre y fecha de turno est√©n visibles y sean correctos.');
                    return false;
                }
            } else { 
            }
            return true;
        }
        
        // Funci√≥n para enviar el mensaje por WhatsApp
        function sendWhatsAppMessage(isReminder, discount, treatment) {
            const name = document.getElementById('name').value;
            const whatsappNumber = '5493415216025'; 
            let message = '';
            const wonRouletteDiscount = localStorage.getItem('wonRouletteDiscount'); 
            const wonRoulettePrizeDescription = localStorage.getItem('wonRoulettePrizeDescription'); 

            if (isReminder) {
                const displayedDate = document.getElementById('displayDate').textContent; 
                message = `¬°Hola Le Bardol! Soy ${name}. Confirmo mi turno asignado para el ${displayedDate}.`;
                if (wonRouletteDiscount && wonRoulettePrizeDescription) {
                    message += ` Adem√°s, quiero aplicar mi premio de ruleta: ${wonRoulettePrizeDescription}.`;
                }
                message += ` Agradezco su confirmaci√≥n. ¬°Saludos!`;
            } else {
                let offerText = "";
                if (discount && treatment) {
                    offerText = `Estoy interesado/a en la promo de ${discount}% de descuento en ${treatment}.`;
                } else if (discount) {
                    offerText = `Estoy interesado/a en la promo de ${discount}% de descuento.`;
                } else if (treatment) {
                    offerText = `Estoy interesado/a en la promo de ${treatment}.`;
                } else {
                    offerText = `Estoy interesado/a en sus servicios y promociones.`;
                }
                message = `¬°Hola Le Bardol! Mi nombre es ${name}. ${offerText} ¬øPodr√≠an brindarme m√°s informaci√≥n o ayudarme a sacar un turno? ¬°Gracias!`;
            }

            // Si hay un premio de ruleta ganado y es de tipo descuento, a√±adir la informaci√≥n de la se√±a
            if (wonRouletteDiscount && wonRoulettePrizeDescription) {
                message += `\n\nPara reservar mi premio (${wonRoulettePrizeDescription}), he abonado la se√±a de ${mercadopagoPrice}.`;
                message += `\nLink de se√±a: ${mercadopagoLinkUrl}`; 
            }
            
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }
        
        // Funci√≥n para compartir la invitaci√≥n (bot√≥n 50% OFF)
        function shareInvitation() {
            const referrerName = document.getElementById('name').value;
            const referrerDiscount = getUrlParameter('descuentoReferente') || '10'; 
            const newClientDiscount = getUrlParameter('descuentoNuevoCliente') || '50'; 
            const friendRouletteDiscount = localStorage.getItem('friendRouletteDiscount'); 

            if (!referrerName || referrerName.trim() === '' || referrerName.trim() === 'Estimado/a cliente/a' || referrerName.trim() === 'Hola!') { 
                alert('Por favor, ingresa tu nombre completo para que tus amigos sepan qui√©n los env√≠a.');
                document.getElementById('name').focus();
                return;
            }

            const whatsappNumberLeBardol = '5493415216025'; 
            
            const finalNewClientDiscount = friendRouletteDiscount ? friendRouletteDiscount : newClientDiscount;

            const messageForFriend = `¬°Hola Le Bardol! Me interesa la promo del ${finalNewClientDiscount}% de descuento en mi primer servicio. Me recomend√≥ ${referrerName}. ¬°Quisiera m√°s informaci√≥n!`;
            
            const referralLink = `https://wa.me/${whatsappNumberLeBardol}?text=${encodeURIComponent(messageForFriend)}`;
            
            const sharedMessage = `¬°Hola! Te recomiendo Le Bardol Est√©tica Center. ¬°Est√°n ofreciendo un ${finalNewClientDiscount}% de descuento en tu primer tratamiento! Solo tienes que contactarlos mencionando que te envi√≥ ${referrerName} para obtener la promo. Adem√°s, por cada amigo que contrate, ¬°yo obtengo un ${referrerDiscount}% de descuento en mi pr√≥ximo servicio!\n\nüëâ Cont√°ctalos aqu√≠ y obt√©n tu descuento: ${referralLink}`;
            
            window.open(`https://wa.me/?text=${encodeURIComponent(sharedMessage)}`, '_blank');
        }

        // Funci√≥n para compartir la invitaci√≥n desde la nueva tarjeta de difusi√≥n (5% OFF)
        function shareInvitationDiffusion() {
            const whatsappNumberLeBardol = '5493415216025'; 
            const nameFromInput = document.getElementById('name').value;
            const referrerName = (nameFromInput && nameFromInput.trim() !== '' && nameFromInput.trim() !== 'Hola!') ? nameFromInput : 'un amigo/a';

            const diffusionReferrerDiscount = getUrlParameter('descuentoReferenteDifusion') || '5'; 
            const diffusionNewClientDiscount = getUrlParameter('descuentoNuevoClienteDifusion') || '5'; 

            const messageForFriend = `¬°Hola Le Bardol! Me interesa la promo de referido. Me envi√≥ ${referrerName} y quiero mi ${diffusionNewClientDiscount}% de descuento en mi primer servicio.`;
            
            const referralLink = `https://wa.me/${whatsappNumberLeBardol}?text=${encodeURIComponent(messageForFriend)}`;
            
            const sharedMessage = `¬°Hola! Te recomiendo Le Bardol Est√©tica Center. ¬°Si mencionas que te envi√©, obtienes un ${diffusionNewClientDiscount}% de descuento en tu primer servicio, y yo tambi√©n gano un ${diffusionReferrerDiscount}% de descuento en mi pr√≥xima sesi√≥n!\n\nüëâ Cont√°ctalos aqu√≠ y obt√©n tu descuento: ${referralLink}`;
            
            window.open(`https://wa.me/?text=${encodeURIComponent(sharedMessage)}`, '_blank');
        }

        // Funci√≥n para habilitar/deshabilitar el bot√≥n de invitaci√≥n del recordatorio
        function toggleInviteButton() {
            const nameInput = document.getElementById('name');
            const inviteBtn = document.getElementById('inviteBtn');
            if (nameInput.value.trim() === '' || nameInput.value.trim() === 'Estimado/a cliente/a' || nameInput.value.trim() === 'Hola!') {
                inviteBtn.disabled = true;
            } else {
                inviteBtn.disabled = false;
            }
        }

        // Funci√≥n para obtener par√°metros de la URL
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // --- L√≥gica de la Ruleta ---
        const canvas = document.getElementById('rouletteCanvas');
        const ctx = canvas.getContext('2d');
        const spinBtn = document.getElementById('spinBtn');
        const useDiscountBtn = document.getElementById('useDiscountBtn');
        const resultMessage = document.getElementById('resultMessage');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const rouletteSection = document.getElementById('rouletteSection'); 
        const spinCountDisplay = document.getElementById('spinCountDisplay'); 
        const prizeTimerDisplay = document.getElementById('prizeTimerDisplay'); 
        const mercadopagoLinkContainer = document.getElementById('mercadopagoLinkContainer'); 
        const mercadopagoLink = document.getElementById('mercadopagoLink'); 
        const mercadopagoPriceDisplay = document.getElementById('mercadopagoPriceDisplay'); 

        // Definici√≥n de los segmentos de la ruleta con tipos de premio
        const segments = [
            { text: '30% OFF Depi', type: 'discount', value: 30, category: 'depilacion', description: '30% de descuento en paquete de depilaci√≥n' },
            { text: 'Nuevo Tiro!', type: 'new_spin', description: '¬°Un nuevo tiro en la ruleta!' },
            { text: '20% Amigo!', type: 'new_spin_friend_discount', friendDiscount: 20, description: '20% de descuento para un amigo + un nuevo tiro' },
            { text: '25% Manicuria', type: 'discount', value: 25, category: 'manicuria', description: '25% de descuento en manicur√≠a' },
            { text: 'Nuevo Tiro!', type: 'new_spin', description: '¬°Un nuevo tiro en la ruleta!' },
            { text: '0% Suerte!', type: 'no_luck_new_spin', description: '0% de descuento. ¬°Suerte en tu pr√≥ximo tiro!' },
            { text: '30% Cosmetologia', type: 'discount', value: 30, category: 'cosmetologia', description: '30% de descuento en cosmetolog√≠a' },
            { text: '35% Masajes', type: 'discount', value: 35, category: 'masajes', description: '35% de descuento en masajes' },
            { text: '20% Pack 3 Masajes', type: 'discount', value: 20, category: 'masajes', pack: 3, description: '20% de descuento en pack de 3 masajes' },
            { text: '20% Pack 3 Depi', type: 'discount', value: 20, category: 'depilacion', pack: 3, description: '20% de descuento en pack de 3 sesiones de depilaci√≥n' },
            { text: '20% Pack 5 Depi', type: 'discount', value: 20, category: 'depilacion', pack: 5, description: '20% de descuento en pack de 5 sesiones de depilaci√≥n' },
            { text: '35% Pack 5 Depi', type: 'discount', value: 35, category: 'depilacion', pack: 5, description: '35% de descuento en pack de 5 sesiones de depilaci√≥n' },
            { text: '20% Comodin', type: 'discount', value: 20, category: 'comodin', description: '20% de descuento comod√≠n para cualquier tratamiento' }
        ];

        const segmentColors = [
            '#FFD1DC', '#FFABAB', '#FFC3A0', '#FF677D', 
            '#D4A5A5', '#392F5B', '#4A47A3', '#3D2B5B',
            '#FFD700', '#ADFF2F', '#8A2BE2', '#00CED1', '#FF6347'
        ]; 

        const arc = (2 * Math.PI) / segments.length; 
        let rotation = 0; 
        let spinSpeed = 0; 
        let continuousSpinSpeed = 0.01; 
        let isContinuouslySpinning = true; 
        let spinning = false; 
        let wonPrize = null; 
        let spinStartTime = 0;
        const spinDuration = 3000; 
        const twentyFourHours = 24 * 60 * 60 * 1000; 
        const prizeReservationTime = 30 * 60 * 1000; 

        let spinAttempts = parseInt(localStorage.getItem('spinAttempts')) || 3; 
        let prizeTimerInterval = null; 

        function drawRoulette() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.save();
            ctx.translate(canvas.width / 2, canvas.height / 2);
            ctx.rotate(rotation);

            for (let i = 0; i < segments.length; i++) {
                const angle = i * arc;
                ctx.beginPath();
                ctx.arc(0, 0, canvas.width / 2, angle, angle + arc);
                ctx.lineTo(0, 0); 
                ctx.closePath();
                ctx.fillStyle = segmentColors[i % segmentColors.length]; 
                ctx.fill();
                ctx.strokeStyle = '#fff'; 
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.save();
                ctx.rotate(angle + arc / 2); 
                ctx.textAlign = 'right';
                ctx.fillStyle = '#fff'; 
                ctx.font = 'bold 16px Segoe UI'; // Ajustado el tama√±o de la fuente
                ctx.fillText(segments[i].text, canvas.width / 2 - 15, 0); 
                ctx.restore();
            }

            ctx.restore(); 
        }

        function updateSpinCountDisplay() {
            spinCountDisplay.textContent = `Te quedan ${spinAttempts} tiro${spinAttempts !== 1 ? 's' : ''}.`;
            if (spinAttempts <= 0) {
                spinBtn.disabled = true;
                resultMessage.textContent = 'No te quedan m√°s tiros por hoy. Vuelve ma√±ana.';
            } else {
                spinBtn.disabled = false;
            }
        }

        function startPrizeTimer() {
            const prizeWonTime = parseInt(localStorage.getItem('prizeWonTime'));
            if (!prizeWonTime) return;

            const endTime = prizeWonTime + prizeReservationTime;

            if (prizeTimerInterval) {
                clearInterval(prizeTimerInterval);
            }

            prizeTimerDisplay.style.display = 'block';
            mercadopagoLinkContainer.style.display = 'block'; 
            useDiscountBtn.style.display = 'inline-block'; 

            mercadopagoLink.href = mercadopagoLinkUrl; 
            mercadopagoPriceDisplay.textContent = mercadopagoPrice; 

            prizeTimerInterval = setInterval(() => {
                const now = Date.now();
                const timeLeft = endTime - now;

                if (timeLeft <= 0) {
                    clearInterval(prizeTimerInterval);
                    prizeTimerDisplay.textContent = '¬°Tiempo agotado! Tu premio ha expirado.';
                    useDiscountBtn.disabled = true;
                    mercadopagoLinkContainer.style.display = 'none'; 
                    localStorage.removeItem('wonRouletteDiscount');
                    localStorage.removeItem('wonRoulettePrizeDescription');
                    localStorage.removeItem('prizeWonTime');
                    return;
                }

                const minutes = Math.floor(timeLeft / (1000 * 60));
                const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                prizeTimerDisplay.textContent = `Tienes ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')} para reservar tu premio.`;
            }, 1000);
        }


        function animateSpin() {
            if (isContinuouslySpinning) {
                rotation += continuousSpinSpeed; 
                drawRoulette();
                requestAnimationFrame(animateSpin);
            } else {
                const elapsed = Date.now() - spinStartTime;
                if (elapsed >= spinDuration) {
                    spinning = false;
                    loadingSpinner.style.display = 'none';
                    
                    const finalAngle = (rotation % (2 * Math.PI) + 2 * Math.PI) % (2 * Math.PI); 
                    let winningIndex = -1;
                    const indicatorAngle = (Math.PI / 2); 
                    
                    for (let i = 0; i < segments.length; i++) {
                        const segmentStartAngle = i * arc;
                        const segmentEndAngle = (i + 1) * arc;
                        
                        let angleUnderIndicator = (indicatorAngle - rotation) % (2 * Math.PI);
                        if (angleUnderIndicator < 0) angleUnderIndicator += (2 * Math.PI); 

                        if (angleUnderIndicator >= segmentStartAngle && angleUnderIndicator < segmentEndAngle) {
                            winningIndex = i;
                            break;
                        }
                    }

                    if (winningIndex === -1) { 
                        winningIndex = Math.floor(Math.random() * segments.length);
                    }
                    
                    wonPrize = segments[winningIndex]; 
                    resultMessage.textContent = `¬°Felicidades! Ganaste: ${wonPrize.text}`;

                    if (wonPrize.type === 'discount') {
                        if (localStorage.getItem('wonRouletteDiscount')) {
                            resultMessage.textContent = `Ya tienes un premio activo (${localStorage.getItem('wonRoulettePrizeDescription')}). ¬°Este tiro es de cortes√≠a!`;
                            spinBtn.disabled = false; 
                            useDiscountBtn.style.display = 'none';
                            mercadopagoLinkContainer.style.display = 'none';
                            prizeTimerDisplay.style.display = 'none';
                            localStorage.setItem('lastSpinTime', Date.now().toString()); 
                        } else {
                            useDiscountBtn.style.display = 'inline-block'; 
                            spinBtn.disabled = true; 
                            localStorage.setItem('wonRouletteDiscount', wonPrize.value);
                            localStorage.setItem('wonRoulettePrizeDescription', wonPrize.description);
                            localStorage.setItem('prizeWonTime', Date.now().toString()); 
                            startPrizeTimer(); 
                            
                            spinAttempts--;
                            localStorage.setItem('spinAttempts', spinAttempts.toString());
                            updateSpinCountDisplay();
                            localStorage.setItem('lastSpinTime', Date.now().toString()); 
                        }
                    } else if (wonPrize.type === 'new_spin' || wonPrize.type === 'no_luck_new_spin') {
                        spinBtn.disabled = false; 
                        useDiscountBtn.style.display = 'none';
                        mercadopagoLinkContainer.style.display = 'none';
                        prizeTimerDisplay.style.display = 'none';
                        localStorage.removeItem('wonRouletteDiscount'); 
                        localStorage.removeItem('wonRoulettePrizeDescription');
                        localStorage.removeItem('prizeWonTime');
                        localStorage.setItem('lastSpinTime', Date.now().toString()); 
                    } else if (wonPrize.type === 'new_spin_friend_discount') {
                        if (localStorage.getItem('wonRouletteDiscount') || localStorage.getItem('friendRouletteDiscount')) {
                            resultMessage.textContent = `Ya tienes un premio activo. ¬°Este tiro es de cortes√≠a!`;
                            spinBtn.disabled = false; 
                            useDiscountBtn.style.display = 'none';
                            mercadopagoLinkContainer.style.display = 'none';
                            prizeTimerDisplay.style.display = 'none';
                            localStorage.setItem('lastSpinTime', Date.now().toString()); 
                        } else {
                            spinBtn.disabled = false; 
                            useDiscountBtn.style.display = 'none';
                            mercadopagoLinkContainer.style.display = 'none';
                            prizeTimerDisplay.style.display = 'none';
                            localStorage.removeItem('wonRouletteDiscount'); 
                            localStorage.removeItem('wonRoulettePrizeDescription');
                            localStorage.removeItem('prizeWonTime');
                            localStorage.setItem('friendRouletteDiscount', wonPrize.friendDiscount); 
                            
                            spinAttempts--;
                            localStorage.setItem('spinAttempts', spinAttempts.toString());
                            updateSpinCountDisplay();
                            localStorage.setItem('lastSpinTime', Date.now().toString()); 
                        }
                    }

                    drawRoulette(); 
                    return;
                }

                let progress = elapsed / spinDuration;
                if (progress < 0.5) { 
                    spinSpeed = 0.05 + (0.15 * progress * 2); 
                } else { 
                    spinSpeed = 0.20 - (0.15 * (progress - 0.5) * 2); 
                }
                rotation += spinSpeed;

                drawRoulette();
                requestAnimationFrame(animateSpin);
            }
        }

        spinBtn.addEventListener('click', () => {
            const lastSpinTime = localStorage.getItem('lastSpinTime');
            const now = Date.now();

            if (lastSpinTime && (now - parseInt(lastSpinTime) < twentyFourHours)) {
                const timeLeft = twentyFourHours - (now - parseInt(lastSpinTime));
                const hoursLeft = Math.ceil(timeLeft / (1000 * 60 * 60));
                resultMessage.textContent = `Ya giraste la ruleta hoy. Vuelve en aproximadamente ${hoursLeft} horas.`;
                spinBtn.disabled = true; 
                return;
            }

            if (spinAttempts <= 0) {
                resultMessage.textContent = 'No te quedan m√°s tiros por hoy. Vuelve ma√±ana.';
                spinBtn.disabled = true;
                return;
            }

            if (spinning) return; 

            isContinuouslySpinning = false; 
            spinning = true; 
            spinBtn.disabled = true;
            useDiscountBtn.style.display = 'none'; 
            mercadopagoLinkContainer.style.display = 'none'; 
            prizeTimerDisplay.style.display = 'none'; 
            resultMessage.textContent = '';
            loadingSpinner.style.display = 'block';
            spinStartTime = Date.now(); 
            
            animateSpin();
        });

        useDiscountBtn.addEventListener('click', () => {
            const currentPrizeDescription = localStorage.getItem('wonRoulettePrizeDescription');
            const prizeWonTime = parseInt(localStorage.getItem('prizeWonTime'));
            const now = Date.now();

            if (!currentPrizeDescription || (now - prizeWonTime > prizeReservationTime)) {
                alert('Tu premio ha expirado o no tienes un premio activo. Por favor, gira la ruleta de nuevo.');
                localStorage.removeItem('wonRouletteDiscount');
                localStorage.removeItem('wonRoulettePrizeDescription');
                localStorage.removeItem('prizeWonTime');
                useDiscountBtn.disabled = true;
                mercadopagoLinkContainer.style.display = 'none';
                prizeTimerDisplay.style.display = 'none';
                return;
            }

            window.open(mercadopagoLinkUrl, '_blank');

            const name = document.getElementById('name').value;
            const whatsappNumber = '5493415216025'; 
            let message = `¬°Hola Le Bardol! Mi nombre es ${name}. He ganado en la ruleta: ${currentPrizeDescription}.`;
            message += `\n\nAcabo de abonar la se√±a de ${mercadopagoPrice} en Mercado Pago para reservar mi premio.`;
            message += `\nLink de pago: ${mercadopagoLinkUrl}`;
            message += `\n¬°Quisiera coordinar mi turno para usarlo!`;
            
            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');

            localStorage.removeItem('wonRouletteDiscount');
            localStorage.removeItem('wonRoulettePrizeDescription');
            localStorage.removeItem('prizeWonTime');
            useDiscountBtn.style.display = 'none';
            mercadopagoLinkContainer.style.display = 'none';
            prizeTimerDisplay.style.display = 'none';
            resultMessage.textContent = '¬°Premio reservado! Revisa tu WhatsApp para coordinar.';
            spinBtn.disabled = false; 
            updateSpinCountDisplay(); 
        });


        // --- Inicializaci√≥n de la p√°gina ---
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOMContentLoaded: Page fully loaded.");
            startCountdown();
            
            const nameInput = document.getElementById('name');
            const displayDateDiv = document.getElementById('displayDate');
            const appointmentDisplayGroup = document.getElementById('appointmentDisplayGroup');
            const confirmBtn = document.getElementById('confirmBtn');
            const inviteBtn = document.getElementById('inviteBtn');
            const inviteBtnDiffusion = document.getElementById('inviteBtnDiffusion');
            const disclaimerMessage = document.getElementById('disclaimerMessage');
            
            const mainOfferCard = document.getElementById('mainOfferCard');
            const offerTitle = document.getElementById('offerTitle');
            const offerDescription = document.getElementById('offerDescription');
            const referralPromoDiffusion = document.getElementById('referralPromoDiffusion');
            const referralPromoDiffusionP = referralPromoDiffusion.querySelector('p');

            const urlParams = new URLSearchParams(window.location.search);
            const urlName = urlParams.get('nombre');
            const urlDate = urlParams.get('fecha');
            const urlDiscount = urlParams.get('descuento');
            const urlTreatment = urlParams.get('tratamiento');
            const urlReferrerDiscount = urlParams.get('descuentoReferente');
            const urlNewClientDiscount = urlParams.get('descuentoNuevoCliente');
            const urlDiffusionReferrerDiscount = urlParams.get('descuentoReferenteDifusion');
            const urlDiffusionNewClientDiscount = urlParams.get('descuentoNuevoClienteDifusion');
            const urlRoulette = urlParams.get('roulette'); 
            const urlRouletteDiscount = urlParams.get('rouletteDiscount'); 

            let isReminderLink = false; 

            // DEBUGGING CONSOLE LOGS
            console.log("--- DEBUGGING INDEX.HTML ---");
            console.log("URL Parameters:");
            console.log("  nombre =", urlName);
            console.log("  fecha =", urlDate);
            console.log("  descuento =", urlDiscount);
            console.log("  tratamiento =", urlTreatment);
            console.log("  descuentoReferente =", urlReferrerDiscount);
            console.log("  descuentoNuevoCliente =", urlNewClientDiscount);
            console.log("  descuentoReferenteDifusion =", urlDiffusionReferrerDiscount);
            console.log("  descuentoNuevoClienteDifusion =", urlDiffusionNewClientDiscount);
            console.log("  roulette =", urlRoulette);
            console.log("  rouletteDiscount =", urlRouletteDiscount);
            console.log("Local Storage:");
            console.log("  hasSpunRoulette =", localStorage.getItem('hasSpunRoulette'));
            console.log("  wonRouletteDiscount =", localStorage.getItem('wonRouletteDiscount'));
            console.log("  wonRoulettePrizeDescription =", localStorage.getItem('wonRoulettePrizeDescription'));
            console.log("  lastSpinTime =", localStorage.getItem('lastSpinTime'));
            console.log("  friendRouletteDiscount =", localStorage.getItem('friendRouletteDiscount'));
            console.log("  spinAttempts =", localStorage.getItem('spinAttempts'));
            console.log("  prizeWonTime =", localStorage.getItem('prizeWonTime'));
            console.log("----------------------------");


            // Ocultar todas las secciones por defecto para controlar su visibilidad
            mainOfferCard.style.display = 'none';
            rouletteSection.style.display = 'none';
            referralPromoDiffusion.style.display = 'none';
            appointmentDisplayGroup.style.display = 'none'; 
            confirmBtn.style.display = 'none'; 
            inviteBtn.style.display = 'none'; 
            inviteBtnDiffusion.style.display = 'none'; 
            disclaimerMessage.style.display = 'none'; 

            // L√≥gica para mostrar las secciones seg√∫n los par√°metros de la URL
            if (urlDate) { 
                console.log("Logic Path: Reminder Link (urlDate is present)");
                isReminderLink = true;
                appointmentDisplayGroup.style.display = 'block'; 
                confirmBtn.style.display = 'block'; 
                disclaimerMessage.style.display = 'block'; 

                if (urlName) {
                    nameInput.value = urlName;
                } else {
                    nameInput.value = "Estimado/a cliente/a"; 
                }
                
                try {
                    const dateObj = new Date(urlDate);
                    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', timeZone: 'America/Argentina/Buenos_Aires' };
                    displayDateDiv.textContent = dateObj.toLocaleDateString('es-ES', options) + ' hs';
                } catch (e) {
                    console.error("Error al parsear la fecha de la URL:", e);
                    displayDateDiv.textContent = "Fecha y hora no v√°lidas";
                }
                confirmBtn.innerHTML = '<i class="fas fa-calendar-check"></i> CONFIRMAR MI TURNO';
                disclaimerMessage.innerHTML = `<i class="fas fa-info-circle"></i> Aqu√≠ puedes confirmar tu turno asignado para el <strong>${displayDateDiv.textContent}</strong>.`;
                
                if (urlDiscount && urlTreatment) {
                    offerTitle.textContent = `¬°${urlDiscount}% OFF en ${urlTreatment}!`;
                    offerDescription.innerHTML = `Como cliente especial, aprovecha un <strong>${urlDiscount}% de descuento</strong> en tu servicio de <strong>${urlTreatment}</strong>. ¬°No te lo pierdas!`;
                    mainOfferCard.style.display = 'block';
                } else if (urlDiscount) {
                    offerTitle.textContent = `¬°${urlDiscount}% DE DESCUENTO EN TU PR√ìXIMO SERVICIO!`;
                    offerDescription.innerHTML = `Como cliente especial, disfruta de un incre√≠ble <strong>${urlDiscount}% de descuento</strong> en tu pr√≥ximo tratamiento. ¬°Tu momento de relajaci√≥n y belleza te espera!`;
                    mainOfferCard.style.display = 'block';
                } else if (urlTreatment) {
                    offerTitle.textContent = `¬°Promoci√≥n Especial en ${urlTreatment}!`;
                    offerDescription.innerHTML = `Descubre los beneficios de nuestro servicio de <strong>${urlTreatment}</strong> con una promoci√≥n exclusiva. ¬°Agenda tu cita hoy mismo!`;
                    mainOfferCard.style.display = 'block';
                } else {
                    offerTitle.textContent = '¬°Oferta Especial de Referidos!';
                    const displayReferrerDiscount = urlReferrerDiscount || '10';
                    const displayNewClientDiscount = urlNewClientDiscount || '50';
                    offerDescription.innerHTML = `Confirma tu turno y si invitas a tus amigos en las pr√≥ximas 24 horas, t√∫ obtienes un <strong>${displayReferrerDiscount}% DE DESCUENTO</strong> por cada uno que contrate un servicio, ¬°y ellos un <strong>${displayNewClientDiscount}% DE DESCUENTO</strong> en su primer tratamiento!`;
                    mainOfferCard.style.display = 'block';
                }
                inviteBtn.style.display = 'block'; 
                inviteBtnDiffusion.style.display = 'none'; 

            } else if (urlRoulette === 'true') { 
                console.log("Logic Path: Roulette Link (urlRoulette is 'true') - Checking conditions...");
                const lastSpinTime = localStorage.getItem('lastSpinTime');
                const now = Date.now();
                
                const activeRoulettePrizeDescription = localStorage.getItem('wonRoulettePrizeDescription');
                const prizeWonTime = parseInt(localStorage.getItem('prizeWonTime'));
                const storedSpinAttempts = parseInt(localStorage.getItem('spinAttempts')); 

                // Always show roulette section if it's a roulette link
                rouletteSection.style.display = 'block';
                mainOfferCard.style.display = 'none'; 
                referralPromoDiffusion.style.display = 'none';
                appointmentDisplayGroup.style.display = 'none';
                confirmBtn.style.display = 'none';
                inviteBtn.style.display = 'none';
                disclaimerMessage.style.display = 'none';

                // Display the general invite button even in roulette mode
                inviteBtnDiffusion.style.display = 'block'; 

                if (activeRoulettePrizeDescription && (now - prizeWonTime <= prizeReservationTime)) {
                    console.log("Condition Met: Active roulette prize found and not expired. Displaying prize info.");
                    spinBtn.style.display = 'none'; 
                    loadingSpinner.style.display = 'none';
                    resultMessage.textContent = `¬°Tu premio activo: ${activeRoulettePrizeDescription}!`;
                    useDiscountBtn.style.display = 'inline-block'; 
                    mercadopagoLinkContainer.style.display = 'block'; 
                    startPrizeTimer(); 
                    updateSpinCountDisplay(); 
                    nameInput.value = urlName || "Hola!"; 
                    nameInput.focus(); 
                    
                } else if (lastSpinTime && (now - parseInt(lastSpinTime) < twentyFourHours)) {
                    console.log("Condition Met: Roulette already spun today (cooldown). Displaying cooldown message.");
                    rouletteSection.style.display = 'none'; // Hide roulette, show main offer card
                    mainOfferCard.style.display = 'block'; 
                    offerTitle.textContent = `¬°Ya giraste la ruleta hoy!`;
                    const timeLeft = twentyFourHours - (now - parseInt(lastSpinTime));
                    const hoursLeft = Math.ceil(timeLeft / (1000 * 60 * 60));
                    offerDescription.innerHTML = `Vuelve en aproximadamente <strong>${hoursLeft} horas</strong> para un nuevo intento. Mientras tanto, ¬°puedes consultar por nuestros servicios!`;
                    
                    appointmentDisplayGroup.style.display = 'none'; 
                    confirmBtn.innerHTML = '<i class="fas fa-phone-alt"></i> CONSULTAR POR UN TURNO';
                    confirmBtn.style.display = 'block';
                    inviteBtn.style.display = 'none'; 
                    // inviteBtnDiffusion.style.display = 'block'; // Already set above for roulette path
                    disclaimerMessage.innerHTML = '<i class="fas fa-bullhorn"></i> ¬°Bienvenido/a a Le Bardol! Aqu√≠ puedes consultar por nuestros servicios y aprovechar nuestras promociones.';
                    disclaimerMessage.style.display = 'block';
                    nameInput.value = urlName || "Hola!"; 
                    nameInput.focus(); 

                } else {
                    console.log("Condition Met: Roulette available to spin. Displaying roulette.");
                    if (!lastSpinTime || (now - parseInt(lastSpinTime) >= twentyFourHours) || (isNaN(storedSpinAttempts) || storedSpinAttempts === 0)) { 
                        console.log("Resetting spin attempts and clearing old roulette data.");
                        spinAttempts = 3;
                        localStorage.setItem('spinAttempts', spinAttempts.toString());
                        localStorage.removeItem('wonRouletteDiscount'); 
                        localStorage.removeItem('wonRoulettePrizeDescription');
                        localStorage.removeItem('prizeWonTime');
                        localStorage.removeItem('friendRouletteDiscount'); 
                        localStorage.removeItem('hasSpunRoulette'); 
                    }
                    updateSpinCountDisplay(); 
                    drawRoulette();
                    animateSpin(); 
                    spinBtn.style.display = 'block'; 
                    useDiscountBtn.style.display = 'none'; 
                    mercadopagoLinkContainer.style.display = 'none'; 
                    prizeTimerDisplay.style.display = 'none'; 
                }

            } else if (urlRouletteDiscount) {
                console.log("Logic Path: Roulette Discount Received (urlRouletteDiscount is present)");
                rouletteSection.style.display = 'none';
                mainOfferCard.style.display = 'block'; 
                offerTitle.textContent = `¬°Tu Descuento de Ruleta: ${urlRouletteDiscount}% OFF!`;
                const prizeDesc = localStorage.getItem('wonRoulettePrizeDescription') || `${urlRouletteDiscount}% de descuento`;
                offerDescription.innerHTML = `¬°Felicidades! Has ganado <strong>${prizeDesc}</strong>. Utiliza el bot√≥n "CONSULTAR POR UN TURNO" para contactarnos y aplicar tu premio.`;
                
                localStorage.setItem('wonRouletteDiscount', urlRouletteDiscount);
                localStorage.setItem('wonRoulettePrizeDescription', prizeDesc); 
                
                appointmentDisplayGroup.style.display = 'none'; 
                confirmBtn.innerHTML = '<i class="fas fa-phone-alt"></i> CONSULTAR POR UN TURNO';
                confirmBtn.style.display = 'block';
                inviteBtn.style.display = 'none'; 
                inviteBtnDiffusion.style.display = 'none'; 
                disclaimerMessage.innerHTML = '<i class="fas fa-bullhorn"></i> ¬°Usa tu descuento de la ruleta! Completa tus datos para contactarnos.';
                disclaimerMessage.style.display = 'block';
                nameInput.value = urlName || "Hola!"; 
                nameInput.focus(); 

            } else { 
                console.log("Logic Path: General Promotion/Default (no specific URL parameters)");
                isReminderLink = false;
                appointmentDisplayGroup.style.display = 'none'; 
                confirmBtn.style.display = 'block'; 
                disclaimerMessage.style.display = 'block'; 

                if (urlName) {
                    nameInput.value = urlName;
                } else {
                    nameInput.value = "Hola!"; 
                }
                confirmBtn.innerHTML = '<i class="fas fa-phone-alt"></i> CONSULTAR POR UN TURNO';
                disclaimerMessage.innerHTML = '<i class="fas fa-bullhorn"></i> ¬°Bienvenido/a a Le Bardol! Aqu√≠ puedes consultar por nuestros servicios y aprovechar nuestras promociones.';

                if (urlDiscount && urlTreatment) {
                    offerTitle.textContent = `¬°${urlDiscount}% OFF en ${urlTreatment}!`;
                    offerDescription.innerHTML = `Aprovecha esta oportunidad √∫nica y obt√©n un <strong>${urlDiscount}% de descuento</strong> en tu servicio de <strong>${urlTreatment}</strong>. ¬°No te lo pierdas!`;
                    mainOfferCard.style.display = 'block'; 
                    referralPromoDiffusion.style.display = 'block'; 
                    inviteBtnDiffusion.style.display = 'block'; 
                } else if (urlDiscount) {
                    offerTitle.textContent = `¬°${urlDiscount}% DE DESCUENTO EN TODOS LOS SERVICIOS!`;
                    offerDescription.innerHTML = `Disfruta de un incre√≠ble <strong>${urlDiscount}% de descuento</strong> en cualquiera de nuestros tratamientos. ¬°Tu momento de relajaci√≥n y belleza te espera!`;
                    mainOfferCard.style.display = 'block';
                    referralPromoDiffusion.style.display = 'block';
                    inviteBtnDiffusion.style.display = 'block';
                } else if (urlTreatment) {
                    offerTitle.textContent = `¬°Promoci√≥n Especial en ${urlTreatment}!`;
                    offerDescription.innerHTML = `Descubre los beneficios de nuestro servicio de <strong>${urlTreatment}</strong> con una promoci√≥n exclusiva. ¬°Agenda tu cita hoy mismo!`;
                    mainOfferCard.style.display = 'block';
                    referralPromoDiffusion.style.display = 'block';
                    inviteBtnDiffusion.style.display = 'block';
                } else {
                    mainOfferCard.style.display = 'none'; 
                    referralPromoDiffusion.style.display = 'block'; 
                    inviteBtnDiffusion.style.display = 'block';
                }
                inviteBtn.style.display = 'none'; 

                const displayDiffusionReferrerDiscount = urlDiffusionReferrerDiscount || '5';
                const displayDiffusionNewClientDiscount = urlDiffusionNewClientDiscount || '5';
                referralPromoDiffusionP.innerHTML = `Si reservas un turno y nos recomiendas a un amigo, obtendr√°s un <strong>${displayDiffusionReferrerDiscount}% DE DESCUENTO ADICIONAL</strong> en tu pr√≥xima sesi√≥n cuando tu amigo contrate su primer servicio, ¬°y tu amigo obtendr√° un <strong>${displayDiffusionNewClientDiscount}% DE DESCUENTO</strong> en su primer servicio!`;
            }

            // Asignar eventos a los botones (siempre, independientemente de la secci√≥n visible)
            document.getElementById('confirmBtn').addEventListener('click', () => {
                if (validateForm(isReminderLink)) {
                    sendWhatsAppMessage(isReminderLink, urlDiscount, urlTreatment);
                    showNotification();
                }
            });
            
            document.getElementById('inviteBtn').addEventListener('click', shareInvitation); 
            document.getElementById('inviteBtnDiffusion').addEventListener('click', shareInvitationDiffusion); 

            nameInput.addEventListener('input', toggleInviteButton);
            
            if (isReminderLink) {
                toggleInviteButton(); 
            } else {
                inviteBtn.disabled = false; 
            }
        });
    </script>
  </body>
</html>
